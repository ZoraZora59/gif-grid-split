<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="format-detection" content="telephone=no">
    <title>Sprite → GIF | 精灵表动画转换器</title>
    <!-- PWA 图标 -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎮</text></svg>">
    <!-- 字体 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- 背景动效 -->
    <div class="bg-grid"></div>
    <div class="bg-glow"></div>
    
    <!-- 主容器 -->
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">◈</span>
                <h1>SPRITE<span class="accent">→</span>GIF</h1>
            </div>
            <p class="tagline">智能精灵表动画转换器</p>
        </header>

        <!-- 主要内容区 -->
        <main class="main-content">
            <!-- 步骤指示器 -->
            <div class="steps-indicator">
                <div class="step active" data-step="1">
                    <span class="step-num">01</span>
                    <span class="step-label">上传</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2">
                    <span class="step-num">02</span>
                    <span class="step-label">配置</span>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3">
                    <span class="step-num">03</span>
                    <span class="step-label">下载</span>
                </div>
            </div>

            <!-- 上传区域 -->
            <section id="upload-section" class="section active">
                <!-- Tab 切换 -->
                <div class="source-tabs">
                    <button class="source-tab active" data-tab="ai-generate">
                        <span class="tab-icon">✨</span>
                        <span class="tab-text">AI 生成</span>
                    </button>
                    <button class="source-tab" data-tab="manual-upload">
                        <span class="tab-icon">📤</span>
                        <span class="tab-text">手动上传</span>
                    </button>
                </div>

                <!-- AI 生成面板 -->
                <div id="ai-generate-panel" class="tab-panel active">
                    <!-- 模板选择 -->
                    <div class="template-section">
                        <h3 class="section-title">选择动作模板</h3>
                        <div class="template-grid" id="template-grid">
                            <div class="template-card" data-template="weapon-attack">
                                <span class="template-icon">⚔️</span>
                                <span class="template-name">武器战斗</span>
                            </div>
                            <div class="template-card" data-template="elegant-exit">
                                <span class="template-icon">🚗</span>
                                <span class="template-name">优雅下车</span>
                            </div>
                            <div class="template-card" data-template="martial-arts">
                                <span class="template-icon">🥋</span>
                                <span class="template-name">武术连招</span>
                            </div>
                            <div class="template-card" data-template="magic-spell">
                                <span class="template-icon">🔮</span>
                                <span class="template-name">魔法释放</span>
                            </div>
                            <div class="template-card" data-template="parkour">
                                <span class="template-icon">🏃</span>
                                <span class="template-name">跑酷跳跃</span>
                            </div>
                        </div>
                    </div>

                    <!-- 参考图上传 -->
                    <div class="reference-section">
                        <h3 class="section-title">参考图（可选）</h3>
                        <div class="reference-upload" id="reference-upload">
                            <div class="reference-placeholder" id="reference-placeholder">
                                <span class="ref-icon">🖼️</span>
                                <span class="ref-text">点击或拖放上传造型参考图</span>
                                <span class="ref-hint">AI 将基于参考图生成角色</span>
                            </div>
                            <div class="reference-preview hidden" id="reference-preview">
                                <img id="reference-image" src="" alt="参考图">
                                <button class="ref-remove" id="ref-remove" title="移除参考图">×</button>
                            </div>
                            <input type="file" id="reference-input" accept="image/*" hidden>
                        </div>
                    </div>

                    <!-- 提示词编辑 -->
                    <div class="prompt-section">
                        <div class="prompt-header">
                            <h3 class="section-title">提示词</h3>
                            <span class="template-badge" id="template-badge">武器战斗</span>
                        </div>
                        <textarea id="prompt-input" class="prompt-textarea" rows="8" placeholder="请选择模板或输入自定义提示词..."></textarea>
                        <div class="prompt-hint">
                            <span>💡 修改提示词后将变为"自定义"模式</span>
                        </div>
                    </div>

                    <!-- 生成按钮 -->
                    <button id="generate-btn" class="btn btn-primary btn-generate">
                        <span class="btn-icon">🚀</span>
                        <span class="btn-text">生成精灵表</span>
                    </button>
                </div>

                <!-- 手动上传面板 -->
                <div id="manual-upload-panel" class="tab-panel">
                    <div class="upload-zone" id="upload-zone">
                        <div class="upload-content">
                            <div class="upload-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17 8 12 3 7 8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                            </div>
                            <h3>拖放精灵表图片到这里</h3>
                            <p>或点击选择文件</p>
                            <span class="upload-hint">支持 PNG, JPG, WebP 等格式 · 最大 16MB</span>
                        </div>
                        <input type="file" id="file-input" accept="image/*" hidden>
                    </div>
                </div>
                
                <!-- 预览区域（两种模式共用） -->
                <div id="preview-container" class="preview-container hidden">
                    <div class="preview-image-wrapper">
                        <img id="preview-image" src="" alt="预览">
                        <div class="preview-overlay">
                            <span class="preview-badge" id="preview-badge">原始图片</span>
                        </div>
                    </div>
                    <div class="preview-info">
                        <div class="info-item">
                            <span class="info-label">尺寸</span>
                            <span class="info-value" id="info-size">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">来源</span>
                            <span class="info-value" id="info-filename">-</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 配置区域 -->
            <section id="config-section" class="section">
                <div class="config-layout">
                    <!-- 左侧：网格预览 -->
                    <div class="grid-preview-card">
                        <div class="preview-header">
                            <h3>📐 网格预览</h3>
                            <label class="toggle-label">
                                <input type="checkbox" id="show-numbers" checked>
                                <span>显示编号</span>
                            </label>
                        </div>
                        <div class="grid-preview-container" id="grid-preview-container">
                            <canvas id="grid-preview-canvas" class="grid-preview-canvas"></canvas>
                        </div>
                        <div class="preview-stats">
                            <span id="preview-cell-size">单帧尺寸: - × -</span>
                            <span id="preview-total-frames">总帧数: -</span>
                        </div>
                        
                        <!-- 第一帧预览 -->
                        <div class="first-frame-preview">
                            <div class="first-frame-header">
                                <span>🎬 第1帧预览</span>
                            </div>
                            <div class="first-frame-container">
                                <canvas id="first-frame-canvas"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 右侧：配置面板 -->
                    <div class="config-card">
                        <div class="config-header">
                            <h2>🔍 智能分析结果</h2>
                            <div class="confidence-badge" id="confidence-badge">
                                <span class="confidence-value">--</span>%
                            </div>
                        </div>
                        
                        <div class="detected-info">
                            <div class="detected-item">
                                <span class="detected-label">检测到网格</span>
                                <span class="detected-value" id="detected-grid">- × -</span>
                            </div>
                            <div class="detected-item">
                                <span class="detected-label">总帧数</span>
                                <span class="detected-value" id="detected-frames">-</span>
                            </div>
                            <div class="detected-item">
                                <span class="detected-label">分隔线宽度</span>
                                <span class="detected-value" id="detected-linewidth">- px</span>
                            </div>
                        </div>
                        
                        <!-- 低置信度提示 -->
                        <div id="low-confidence-tip" class="tip-box hidden">
                            <span class="tip-icon">💡</span>
                            <div class="tip-content">
                                <strong>检测精度较低</strong>
                                <p>请手动调整下方的行数和列数</p>
                            </div>
                        </div>

                        <div class="config-form">
                            <h3>⚙️ 参数调整 <span class="form-subtitle">（实时预览）</span></h3>
                            
                            <!-- 快速预设按钮 -->
                            <div class="preset-section">
                                <label class="preset-label">快速选择网格：</label>
                                <div class="preset-buttons" id="preset-buttons">
                                    <button type="button" class="preset-btn" data-rows="2" data-cols="2">2×2</button>
                                    <button type="button" class="preset-btn" data-rows="3" data-cols="3">3×3</button>
                                    <button type="button" class="preset-btn" data-rows="4" data-cols="4">4×4</button>
                                    <button type="button" class="preset-btn" data-rows="5" data-cols="5">5×5</button>
                                    <button type="button" class="preset-btn" data-rows="6" data-cols="6">6×6</button>
                                    <button type="button" class="preset-btn" data-rows="8" data-cols="8">8×8</button>
                                    <button type="button" class="preset-btn" data-rows="4" data-cols="6">4×6</button>
                                    <button type="button" class="preset-btn" data-rows="6" data-cols="4">6×4</button>
                                    <button type="button" class="preset-btn" data-rows="4" data-cols="8">4×8</button>
                                    <button type="button" class="preset-btn" data-rows="5" data-cols="6">5×6</button>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="rows">行数</label>
                                    <div class="input-with-btns">
                                        <button type="button" class="adj-btn" data-target="rows" data-delta="-1">−</button>
                                        <input type="number" id="rows" min="1" max="50" value="6">
                                        <button type="button" class="adj-btn" data-target="rows" data-delta="1">+</button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="cols">列数</label>
                                    <div class="input-with-btns">
                                        <button type="button" class="adj-btn" data-target="cols" data-delta="-1">−</button>
                                        <input type="number" id="cols" min="1" max="50" value="6">
                                        <button type="button" class="adj-btn" data-target="cols" data-delta="1">+</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="margin">边距 (px)</label>
                                    <input type="number" id="margin" min="0" max="50" value="0">
                                    <span class="form-hint">去除格子间的黑边</span>
                                </div>
                                <div class="form-group">
                                    <label for="duration">帧速度 (ms)</label>
                                    <input type="number" id="duration" min="10" max="1000" value="80">
                                    <span class="form-hint">数值越小越快</span>
                                </div>
                            </div>
                        </div>

                        <button id="convert-btn" class="btn btn-primary">
                            <span class="btn-text">生成 GIF 动画</span>
                            <span class="btn-icon">→</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- 结果区域 -->
            <section id="result-section" class="section">
                <div class="result-card">
                    <div class="result-header">
                        <h2>✨ 转换完成</h2>
                    </div>
                    
                    <div class="result-preview">
                        <img id="result-gif" src="" alt="生成的GIF">
                    </div>
                    
                    <div class="result-actions">
                        <a id="download-btn" class="btn btn-primary" download="sprite_animation.gif">
                            <span class="btn-icon">↓</span>
                            <span class="btn-text">下载 GIF</span>
                        </a>
                        <button id="restart-btn" class="btn btn-secondary">
                            <span class="btn-text">转换另一张</span>
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- 加载状态 -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p class="loading-text" id="loading-text">正在分析...</p>
            </div>
        </div>

        <!-- 页脚 -->
        <footer class="footer">
            <p>Powered by AI Vision • 无需注册 • 文件不存储</p>
        </footer>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>

